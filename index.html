<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>DeepSeek Streaming Chat</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body { font-family: Arial; max-width: 700px; margin: 40px auto; }
    #chat { border: 1px solid #ccc; height: 400px; overflow-y: auto; padding: 10px; }
    .user { color: blue; margin: 5px 0; }
    .ai { color: green; margin: 5px 0; }
    input { width: 75%; padding: 5px; }
    button { padding: 5px 10px; }
  </style>
</head>
<body>

<h2>DeepSeek Chat (Streaming + Memory)</h2>

<div id="chat"></div>

<input id="input" placeholder="Type message..." />
<button onclick="send()">Send</button>

<script>
let conversation = [
  { role: "system", content: "You are a helpful assistant." }
];

const chatDiv = document.getElementById("chat");

function addMessage(text, cls) {
  const div = document.createElement("div");
  div.className = cls;
  div.textContent = text;
  chatDiv.appendChild(div);
  chatDiv.scrollTop = chatDiv.scrollHeight;
  return div;
}

async function send() {
  const input = document.getElementById("input");
  const message = input.value;
  if (!message) return;

  conversation.push({ role: "user", content: message });
  addMessage("You: " + message, "user");
  input.value = "";

  const aiDiv = addMessage("AI: ", "ai");

  const response = await fetch("/.netlify/functions/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ messages: conversation })
  });

  const reader = response.body.getReader();
  const decoder = new TextDecoder();

  let aiText = "";

  while (true) {
    const { done, value } = await reader.read();
    if (done) break;

    const chunk = decoder.decode(value);
    aiText += chunk;
    aiDiv.textContent = "AI: " + aiText;
  }

  conversation.push({ role: "assistant", content: aiText });
}
</script>

</body>
</html>
